<html>

<!-- <body onload="initializeVariables()"> -->
<body  onload="init()">
 <button onclick="login()">Login</button>
 <button onclick="getPlayLists()">Listar playlists</button> 

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<script>



function init() {
debugger;
// Get the hash of the url
const hash = window.location.hash
.substring(1)
.split('&')
.reduce(function (initial, item) {
  if (item) {
    var parts = item.split('=');
    initial[parts[0]] = decodeURIComponent(parts[1]);
  }
  return initial;
}, {});
window.location.hash = '';

// Set token
let _token = hash.access_token;

const authEndpoint = 'https://accounts.spotify.com/authorize';

// Replace with your app's client ID, redirect URI and desired scopes
const clientId = '52f9e97b6df9462c9f239085ffb73145';
const redirectUri = encodeURI(window.location.href);
const scopes = [
  'user-top-read'
];

// If there is no token, redirect to Spotify authorization
if (!_token) {
  window.location = `${authEndpoint}?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scopes.join('%20')}&response_type=token&show_dialog=true`;
}

// Make a call using the token
//$.ajax({
//   url: "https://api.spotify.com/v1/me/top/artists",
//   type: "GET",
//   beforeSend: function(xhr){xhr.setRequestHeader('Authorization', 'Bearer ' + _token );},
//   success: function(data) { 
//     // Do something with the returned data
//    data.items.map(function(artist) {
 //      let item = $('<li>' + artist.name + '</li>');
 //      item.appendTo($('#top-artists'));
 //    });
 //  }
//});
}

function initializeVariables() {
 this._client_id = '52f9e97b6df9462c9f239085ffb73145';
  this._client_secret = 'c6b9a2ca5d204d7983d4377566f9d8bf';
}


function login() {
// Get the hash of the url
const hash = window.location.hash
.substring(1)
.split('&')
.reduce(function (initial, item) {
  if (item) {
    var parts = item.split('=');
    initial[parts[0]] = decodeURIComponent(parts[1]);
  }
  return initial;
}, {});
window.location.hash = '';

// Set token
let _token = hash.access_token;

const authEndpoint = 'https://accounts.spotify.com/authorize';

// Replace with your app's client ID, redirect URI and desired scopes
const clientId = '52f9e97b6df9462c9f239085ffb73145';
const redirectUri = window.location.href;
const scopes = [
  'user-top-read'
];

// If there is no token, redirect to Spotify authorization
if (!_token) {
  window.location = `${authEndpoint}?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scopes.join('%20')}&response_type=token&show_dialog=true`;
}

// Make a call using the token
//$.ajax({
//   url: "https://api.spotify.com/v1/me/top/artists",
//   type: "GET",
//   beforeSend: function(xhr){xhr.setRequestHeader('Authorization', 'Bearer ' + _token );},
 //  success: function(data) { 
//     // Do something with the returned data
//     data.items.map(function(artist) {
 //      let item = $('<li>' + artist.name + '</li>');
 //      item.appendTo($('#top-artists'));
 //    });
//   }
//});
}

function getPlayLists() {
  debugger;
  $.ajax({
    url: 'https://api.spotify.com/v1/me/playlists ',
    headers: {
      'Authorization': 'Bearer ' + this._accessToken
    },
    success: function(response) {
	debugger;
      //$(".recommendations").show();
     // mapOverSongs(response.items);
    }
  });
}
</script>
</body>
</html>
